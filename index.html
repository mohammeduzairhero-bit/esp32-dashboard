<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root{
  --bg:#0f172a;
  --card:#020617;
  --glow:#ffeb3b;
}
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(180deg,#020617,#0f172a);
  color:white;
}
header{
  background:#020617;
  padding:18px;
  text-align:center;
  font-size:22px;
}

/* ===== ROOMS DASHBOARD ===== */
.rooms{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
  padding:20px;
}
.room{
  position:relative;
  background:var(--card);
  padding:30px;
  border-radius:22px;
  text-align:center;
  cursor:pointer;
  overflow:hidden;
  transition:.4s;
}
.room:hover{transform:scale(1.05);}

/* Window light */
.room::after{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(circle at center,
    rgba(255,235,59,.45),
    transparent 60%);
  opacity:0;
  transition:.4s;
}
.room.on::after{
  opacity:1;
  animation:roomGlow 2.5s infinite alternate;
}

/* Pulse ring */
.room.on::before{
  content:"";
  position:absolute;
  inset:-6px;
  border-radius:24px;
  border:2px solid rgba(255,235,59,.5);
  animation:pulse 2s infinite;
}

@keyframes pulse{
  from{opacity:.7; transform:scale(1);}
  to{opacity:0; transform:scale(1.1);}
}

@keyframes roomGlow{
  from{opacity:.6;}
  to{opacity:1;}
}

/* Small bulb indicator */
.room .miniBulb{
  font-size:18px;
  display:block;
  margin-top:8px;
  color:#374151;
}
.room.on .miniBulb{
  color:var(--glow);
  text-shadow:0 0 10px var(--glow);
}

/* ===== DEVICE PAGE ===== */
.devices{padding:20px;}
.card{
  background:var(--card);
  border-radius:22px;
  padding:20px;
  margin-bottom:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  animation:fadeIn .4s ease;
}
@keyframes fadeIn{
  from{opacity:0; transform:translateY(10px);}
  to{opacity:1;}
}

/* Bulb */
.bulb{
  font-size:42px;
  color:#374151;
  transition:.4s;
}
.bulb.on{
  color:var(--glow);
  text-shadow:0 0 25px var(--glow);
  animation:glow 1.5s infinite alternate;
}
@keyframes glow{
  from{text-shadow:0 0 12px var(--glow);}
  to{text-shadow:0 0 35px var(--glow);}
}

/* Buttons */
.toggleBtn{
  background:#1e293b;
  border:none;
  color:white;
  padding:10px 18px;
  border-radius:14px;
  cursor:pointer;
  transition:.3s;
}
.toggleBtn:hover{background:#334155;}
.toggleBtn:active{transform:scale(.95);}

.back{
  width:100%;
  background:#2563eb;
  border:none;
  color:white;
  padding:12px;
  border-radius:12px;
}
</style>
</head>

<body>

<header>ğŸ  Smart Home</header>

<!-- DASHBOARD -->
<div id="roomPage" class="rooms">
  <div class="room" id="roomBedroom" onclick="openRoom('Bedroom')">
    ğŸ› Bedroom
    <span class="miniBulb">ğŸ’¡</span>
  </div>
  <div class="room" id="roomBathroom" onclick="openRoom('Bathroom')">
    ğŸš¿ Bathroom
    <span class="miniBulb">ğŸ’¡</span>
  </div>
  <div class="room" id="roomHall" onclick="openRoom('Hall')">
    ğŸ›‹ Hall
    <span class="miniBulb">ğŸ’¡</span>
  </div>
  <div class="room" id="roomDining" onclick="openRoom('Dining')">
    ğŸ½ Dining
    <span class="miniBulb">ğŸ’¡</span>
  </div>
  <div class="room" id="roomKitchen" onclick="openRoom('Kitchen')">
    ğŸ³ Kitchen
    <span class="miniBulb">ğŸ’¡</span>
  </div>
  <div class="room" id="roomParking" onclick="openRoom('Parking')">
    ğŸš— Parking
    <span class="miniBulb">ğŸ’¡</span>
  </div>
</div>

<!-- DEVICES -->
<div id="devicePage" class="devices" style="display:none;">
  <h2 id="roomTitle"></h2>
  <div id="deviceList"></div>
  <button class="back" onclick="goBack()">â¬… Back</button>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyD6rNf_NzDgBvmdCWfmyXAnlfLsHeM3whA",
  databaseURL:"https://esp32-home-automationz-default-rtdb.asia-southeast1.firebasedatabase.app/"
});
const db=firebase.database();

const roomLEDs={
  Bedroom:[1,2],
  Bathroom:[3],
  Hall:[4],
  Dining:[5],
  Kitchen:[6],
  Parking:[7]
};

/* DASHBOARD LIVE STATUS */
Object.keys(roomLEDs).forEach(room=>{
  roomLEDs[room].forEach(led=>{
    db.ref("led"+led).on("value",snap=>{
      if(snap.val()==1){
        document.getElementById("room"+room).classList.add("on");
      }else{
        checkRoom(room);
      }
    });
  });
});

function checkRoom(room){
  let any=false;
  roomLEDs[room].forEach(led=>{
    db.ref("led"+led).once("value",s=>{
      if(s.val()==1){
        any=true;
        document.getElementById("room"+room).classList.add("on");
      }
    });
  });
  if(!any){
    document.getElementById("room"+room).classList.remove("on");
  }
}

/* OPEN ROOM */
function openRoom(room){
  roomPage.style.display="none";
  devicePage.style.display="block";
  roomTitle.innerText=room;
  deviceList.innerHTML="";

  roomLEDs[room].forEach(led=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div>
        <div>Light ${led}</div>
        <div class="bulb" id="bulb${led}">ğŸ’¡</div>
      </div>
      <button class="toggleBtn" onclick="toggleLed(${led})">Toggle</button>
    `;
    deviceList.appendChild(card);

    db.ref("led"+led).on("value",snap=>{
      document.getElementById("bulb"+led)
        .classList.toggle("on",snap.val()==1);
    });
  });
}

function toggleLed(led){
  db.ref("led"+led).once("value").then(snap=>{
    db.ref().update({["led"+led]: snap.val()==1?0:1});
  });
}

function goBack(){
  devicePage.style.display="none";
  roomPage.style.display="grid";
}
</script>

</body>
</html>
