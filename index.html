<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root{
  --bg:#0f172a;
  --card:#020617;
  --accent:#ffeb3b;
}
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(180deg,#020617,#0f172a);
  color:white;
}
header{
  background:#020617;
  padding:18px;
  text-align:center;
  font-size:22px;
}

/* ROOMS */
.rooms{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
  padding:20px;
}
.room{
  position:relative;
  background:var(--card);
  padding:35px;
  border-radius:22px;
  text-align:center;
  cursor:pointer;
  transition:.4s;
  overflow:hidden;
}
.room:hover{ transform:scale(1.05); }

.room::after{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(circle,rgba(255,235,59,.4),transparent 60%);
  opacity:0;
  transition:.4s;
}
.room.on::after{ opacity:1; }

/* DEVICE PAGE */
.devices{ padding:20px; }
.card{
  background:var(--card);
  border-radius:22px;
  padding:20px;
  margin-bottom:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  animation:fadeIn .5s ease;
}
@keyframes fadeIn{
  from{opacity:0; transform:translateY(10px);}
  to{opacity:1; transform:none;}
}

/* BULB */
.bulb{
  font-size:42px;
  color:#374151;
  transition:.4s;
}
.bulb.on{
  color:var(--accent);
  text-shadow:0 0 25px var(--accent);
  animation:glow 1.5s infinite alternate;
}
@keyframes glow{
  from{ text-shadow:0 0 12px var(--accent);}
  to{ text-shadow:0 0 35px var(--accent);}
}

/* BUTTON */
.toggleBtn{
  background:#1e293b;
  border:none;
  color:white;
  padding:10px 18px;
  border-radius:12px;
  cursor:pointer;
  transition:.3s;
}
.toggleBtn:hover{ background:#334155; }
.toggleBtn:active{ transform:scale(.95); }

.back{
  width:100%;
  background:#2563eb;
  border:none;
  color:white;
  padding:12px;
  border-radius:12px;
  margin-top:10px;
}
</style>
</head>

<body>

<header>üè† Smart Home</header>

<div id="roomPage" class="rooms">
  <div class="room" id="roomBedroom" onclick="openRoom('Bedroom')">üõè Bedroom</div>
  <div class="room" id="roomBathroom" onclick="openRoom('Bathroom')">üöø Bathroom</div>
  <div class="room" id="roomHall" onclick="openRoom('Hall')">üõã Hall</div>
  <div class="room" id="roomDining" onclick="openRoom('Dining')">üçΩ Dining</div>
  <div class="room" id="roomKitchen" onclick="openRoom('Kitchen')">üç≥ Kitchen</div>
  <div class="room" id="roomParking" onclick="openRoom('Parking')">üöó Parking</div>
</div>

<div id="devicePage" class="devices" style="display:none;">
  <h2 id="roomTitle"></h2>
  <div id="deviceList"></div>
  <button class="back" onclick="goBack()">‚¨Ö Back</button>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyD6rNf_NzDgBvmdCWfmyXAnlfLsHeM3whA",
  databaseURL:"https://esp32-home-automationz-default-rtdb.asia-southeast1.firebasedatabase.app/"
});

const db=firebase.database();

const roomLEDs={
  Bedroom:[1,2],
  Bathroom:[3],
  Hall:[4],
  Dining:[5],
  Kitchen:[6],
  Parking:[7]
};

function openRoom(room){
  roomPage.style.display="none";
  devicePage.style.display="block";
  roomTitle.innerText=room;
  deviceList.innerHTML="";

  roomLEDs[room].forEach(led=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div>
        <div>Light ${led}</div>
        <div class="bulb" id="bulb${led}">üí°</div>
      </div>
      <button class="toggleBtn" onclick="toggleLed(${led})">Toggle</button>
    `;
    deviceList.appendChild(card);

    db.ref("led"+led).on("value",snap=>{
      const on=snap.val()==1;
      document.getElementById("bulb"+led).classList.toggle("on",on);
      updateRoomGlow();
    });
  });
}

function toggleLed(led){
  db.ref("led"+led).once("value").then(snap=>{
    const newState = snap.val()==1?0:1;
    db.ref().update({["led"+led]:newState});
  });
}

function updateRoomGlow(){
  Object.keys(roomLEDs).forEach(room=>{
    let active=false;
    roomLEDs[room].forEach(led=>{
      db.ref("led"+led).once("value",s=>{
        if(s.val()==1){
          active=true;
          document.getElementById("room"+room).classList.add("on");
        }
      });
    });
    if(!active){
      document.getElementById("room"+room).classList.remove("on");
    }
  });
}

function goBack(){
  devicePage.style.display="none";
  roomPage.style.display="grid";
}
</script>

</body>
</html>
