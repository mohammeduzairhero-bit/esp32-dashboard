<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(180deg,#020617,#0f172a);
  color:white;
}
header{
  padding:18px;
  font-size:22px;
  text-align:center;
  background:#020617;
}
.rooms{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
  padding:20px;
}
.room{
  position:relative;
  background:#020617;
  padding:35px 15px;
  border-radius:20px;
  text-align:center;
  cursor:pointer;
  transition:.4s;
}
.room:hover{transform:scale(1.05);}
.room::after{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(circle,rgba(255,235,59,.4),transparent 60%);
  opacity:0;
  transition:.4s;
}
.room.on::after{opacity:1;}

.devices{padding:20px;}
.card{
  background:#020617;
  border-radius:20px;
  padding:20px;
  margin-bottom:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.bulb{
  font-size:42px;
  color:#374151;
  transition:.4s;
}
.bulb.on{
  color:#ffeb3b;
  text-shadow:0 0 25px #ffeb3b;
  animation:glow 1.5s infinite alternate;
}
@keyframes glow{
  from{ text-shadow:0 0 15px #ffeb3b;}
  to{ text-shadow:0 0 35px #ffeb3b;}
}
.switch{position:relative;width:55px;height:28px;}
.switch input{display:none;}
.slider{
  position:absolute; inset:0;
  background:#374151;
  border-radius:20px;
}
.slider::before{
  content:"";
  position:absolute;
  width:22px;height:22px;
  background:white;
  border-radius:50%;
  top:3px;left:4px;
  transition:.3s;
}
input:checked + .slider{background:#22c55e;}
input:checked + .slider::before{transform:translateX(26px);}
.back{
  background:#2563eb;
  border:none;
  color:white;
  padding:12px;
  border-radius:12px;
  width:100%;
}
</style>
</head>

<body>

<header>ğŸ  Smart Home</header>

<!-- ROOMS -->
<div id="roomPage" class="rooms">
  <div class="room" id="roomBedroom" data-room="Bedroom">ğŸ› Bedroom</div>
  <div class="room" id="roomBathroom" data-room="Bathroom">ğŸš¿ Bathroom</div>
  <div class="room" id="roomHall" data-room="Hall">ğŸ›‹ Hall</div>
  <div class="room" id="roomDining" data-room="Dining">ğŸ½ Dining</div>
  <div class="room" id="roomKitchen" data-room="Kitchen">ğŸ³ Kitchen</div>
  <div class="room" id="roomParking" data-room="Parking">ğŸš— Parking</div>
</div>

<!-- DEVICES -->
<div id="devicePage" class="devices" style="display:none;">
  <h2 id="roomTitle"></h2>
  <div id="deviceList"></div>
  <button class="back" id="backBtn">â¬… Back</button>
</div>

<script>
/* ===== FIREBASE INIT ===== */
firebase.initializeApp({
  apiKey:"AIzaSyD6rNf_NzDgBvmdCWfmyXAnlfLsHeM3whA",
  databaseURL:"https://esp32-home-automationz-default-rtdb.asia-southeast1.firebasedatabase.app/"
});
const db = firebase.database();

/* ROOM â†’ LED MAP */
const roomLEDs = {
  Bedroom:[1,2],
  Bathroom:[3],
  Hall:[4],
  Dining:[5],
  Kitchen:[6],
  Parking:[7]
};

/* ROOM CLICK HANDLERS */
document.querySelectorAll(".room").forEach(roomDiv=>{
  roomDiv.addEventListener("click",()=>{
    openRoom(roomDiv.dataset.room);
  });
});

/* ROOM GLOW STATUS */
Object.keys(roomLEDs).forEach(room=>{
  roomLEDs[room].forEach(led=>{
    db.ref("led"+led).on("value",()=>{
      let on=false;
      roomLEDs[room].forEach(l=>{
        db.ref("led"+l).once("value",s=>{
          if(s.val()==1){
            on=true;
            document.getElementById("room"+room).classList.add("on");
          }
        });
      });
      if(!on){
        document.getElementById("room"+room).classList.remove("on");
      }
    });
  });
});

/* OPEN ROOM */
function openRoom(room){
  document.getElementById("roomPage").style.display="none";
  document.getElementById("devicePage").style.display="block";
  document.getElementById("roomTitle").innerText=room;
  const deviceList=document.getElementById("deviceList");
  deviceList.innerHTML="";

  roomLEDs[room].forEach(led=>{
    deviceList.innerHTML+=`
      <div class="card">
        <div>
          <div>Light ${led}</div>
          <div class="bulb" id="bulb${led}">ğŸ’¡</div>
        </div>
        <label class="switch">
          <input type="checkbox" id="toggle${led}">
          <span class="slider"></span>
        </label>
      </div>
    `;

    const toggle=document.getElementById("toggle"+led);

    toggle.addEventListener("change",()=>{
      db.ref("led"+led).set(toggle.checked?1:0);
    });

    db.ref("led"+led).on("value",snap=>{
      const state=snap.val();
      toggle.checked=state==1;
      document.getElementById("bulb"+led).classList.toggle("on",state==1);
    });
  });
}

/* BACK */
document.getElementById("backBtn").addEventListener("click",()=>{
  document.getElementById("devicePage").style.display="none";
  document.getElementById("roomPage").style.display="grid";
});
</script>

</body>
</html>
