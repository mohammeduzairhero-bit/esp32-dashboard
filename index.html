<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  margin:0;
  font-family:Segoe UI;
  background:#0f172a;
  color:white;
}
header{
  background:#020617;
  padding:18px;
  text-align:center;
  font-size:22px;
}
.rooms{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
  padding:20px;
}
.room{
  background:#020617;
  padding:30px;
  border-radius:20px;
  text-align:center;
  cursor:pointer;
}
.room:hover{background:#1e293b;}
.devices{padding:20px;}
.card{
  background:#020617;
  padding:20px;
  border-radius:20px;
  margin-bottom:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.bulb{
  font-size:40px;
  color:#374151;
}
.bulb.on{
  color:#ffeb3b;
  text-shadow:0 0 25px #ffeb3b;
}
button{
  padding:10px 15px;
  border:none;
  border-radius:10px;
  background:#22c55e;
  color:black;
  cursor:pointer;
}
.back{
  width:100%;
  background:#2563eb;
  color:white;
}
</style>
</head>

<body>

<header>ğŸ  Smart Home</header>

<div id="roomPage" class="rooms">
  <div class="room" onclick="openRoom('Bedroom')">ğŸ› Bedroom</div>
  <div class="room" onclick="openRoom('Bathroom')">ğŸš¿ Bathroom</div>
  <div class="room" onclick="openRoom('Hall')">ğŸ›‹ Hall</div>
  <div class="room" onclick="openRoom('Dining')">ğŸ½ Dining</div>
  <div class="room" onclick="openRoom('Kitchen')">ğŸ³ Kitchen</div>
  <div class="room" onclick="openRoom('Parking')">ğŸš— Parking</div>
</div>

<div id="devicePage" class="devices" style="display:none;">
  <h2 id="roomTitle"></h2>
  <div id="deviceList"></div>
  <button class="back" onclick="goBack()">â¬… Back</button>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyD6rNf_NzDgBvmdCWfmyXAnlfLsHeM3whA",
  databaseURL:"https://esp32-home-automationz-default-rtdb.asia-southeast1.firebasedatabase.app/"
});

const db = firebase.database();

const roomLEDs={
  Bedroom:[1,2],
  Bathroom:[3],
  Hall:[4],
  Dining:[5],
  Kitchen:[6],
  Parking:[7]
};

function openRoom(room){
  roomPage.style.display="none";
  devicePage.style.display="block";
  roomTitle.innerText=room;
  deviceList.innerHTML="";

  roomLEDs[room].forEach(led=>{
    const card=document.createElement("div");
    card.className="card";

    card.innerHTML=`
      <div>
        <div>Light ${led}</div>
        <div class="bulb" id="bulb${led}">ğŸ’¡</div>
      </div>
      <button onclick="toggleLed(${led})">Toggle</button>
    `;

    deviceList.appendChild(card);

    // SINGLE listener per LED (SAFE)
    db.ref("led"+led).on("value",snap=>{
      document.getElementById("bulb"+led)
        .classList.toggle("on",snap.val()==1);
    });
  });
}

function toggleLed(led){
  db.ref("led"+led).once("value").then(snap=>{
    const newState = snap.val()==1 ? 0 : 1;
    db.ref().update({ ["led"+led]: newState });
  });
}

function goBack(){
  devicePage.style.display="none";
  roomPage.style.display="grid";
}
</script>

</body>
</html>
