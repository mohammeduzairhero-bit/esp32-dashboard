<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(180deg,#020617,#0f172a);
  color: white;
}

header {
  padding: 18px;
  font-size: 22px;
  text-align: center;
  background: #020617;
}

/* HOUSE GRID */
.rooms {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  padding: 20px;
}

.room {
  position: relative;
  background: #020617;
  padding: 35px 15px;
  border-radius: 20px;
  text-align: center;
  font-size: 18px;
  cursor: pointer;
  overflow: hidden;
  transition: 0.4s;
}

/* ROOM LIGHT EFFECT */
.room::after {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at center, rgba(255,235,59,0.4), transparent 60%);
  opacity: 0;
  transition: 0.4s;
}

.room.on::after {
  opacity: 1;
}

.room:hover {
  transform: scale(1.05);
}

/* DEVICE PAGE */
.devices {
  padding: 20px;
}

/* LIGHT CARD */
.card {
  background: #020617;
  border-radius: 20px;
  padding: 20px;
  margin-bottom: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* BULB */
.bulb {
  font-size: 42px;
  color: #374151;
  transition: 0.4s;
}

.bulb.on {
  color: #ffeb3b;
  text-shadow: 0 0 25px #ffeb3b;
  animation: glow 1.5s infinite alternate;
}

@keyframes glow {
  from { text-shadow: 0 0 15px #ffeb3b; }
  to   { text-shadow: 0 0 35px #ffeb3b; }
}

/* SWITCH */
.switch {
  position: relative;
  width: 55px;
  height: 28px;
}
.switch input { display:none; }

.slider {
  position: absolute;
  inset: 0;
  background: #374151;
  border-radius: 20px;
}
.slider::before {
  content:"";
  position:absolute;
  width:22px;
  height:22px;
  background:white;
  border-radius:50%;
  top:3px;
  left:4px;
  transition:.3s;
}
input:checked + .slider {
  background:#22c55e;
}
input:checked + .slider::before {
  transform: translateX(26px);
}

.back {
  background:#2563eb;
  border:none;
  color:white;
  padding:12px;
  border-radius:12px;
  width:100%;
}
</style>
</head>

<body>

<header>üè† Smart Home</header>

<!-- ROOMS -->
<div id="roomPage" class="rooms">
  <div class="room" id="roomBedroom" onclick="openRoom('Bedroom')">üõè Bedroom</div>
  <div class="room" id="roomBathroom" onclick="openRoom('Bathroom')">üöø Bathroom</div>
  <div class="room" id="roomHall" onclick="openRoom('Hall')">üõã Hall</div>
  <div class="room" id="roomDining" onclick="openRoom('Dining')">üçΩ Dining</div>
  <div class="room" id="roomKitchen" onclick="openRoom('Kitchen')">üç≥ Kitchen</div>
  <div class="room" id="roomParking" onclick="openRoom('Parking')">üöó Parking</div>
</div>

<!-- DEVICES -->
<div id="devicePage" class="devices" style="display:none;">
  <h2 id="roomTitle"></h2>
  <div id="deviceList"></div>
  <button class="back" onclick="goBack()">‚¨Ö Back</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD6rNf_NzDgBvmdCWfmyXAnlfLsHeM3whA",
  databaseURL: "https://esp32-home-automationz-default-rtdb.asia-southeast1.firebasedatabase.app/"
});

const db = firebase.database();

/* ROOM ‚Üí LED MAP */
const roomLEDs = {
  Bedroom:[1,2],
  Bathroom:[3],
  Hall:[4],
  Dining:[5],
  Kitchen:[6],
  Parking:[7]
};

/* ROOM LIGHT STATUS */
Object.keys(roomLEDs).forEach(room => {
  roomLEDs[room].forEach(led => {
    db.ref("led"+led).on("value", () => {
      let anyOn = false;
      roomLEDs[room].forEach(l => {
        db.ref("led"+l).once("value", s => {
          if (s.val() === 1) {
            anyOn = true;
            document.getElementById("room"+room).classList.add("on");
          }
        });
      });
      if (!anyOn) {
        document.getElementById("room"+room).classList.remove("on");
      }
    });
  });
});


function openRoom(room){
  roomPage.style.display="none";
  devicePage.style.display="block";
  roomTitle.innerText=room;
  deviceList.innerHTML="";

  roomLEDs[room].forEach(led=>{
    deviceList.innerHTML+=`
    <div class="card">
      <div>
        <div>Light ${led}</div>
        <div class="bulb" id="bulb${led}">üí°</div>
      </div>
      <label class="switch">
        <input type="checkbox" id="toggle${led}" onchange="toggleLed(${led})">
        <span class="slider"></span>
      </label>
    </div>`;
    
    db.ref("led"+led).on("value",snap=>{
      document.getElementById("toggle"+led).checked = snap.val()==1;
document.getElementById("bulb"+led).classList.toggle("on", snap.val()==1);

    });
  });
}

function goBack(){
  devicePage.style.display="none";
  roomPage.style.display="grid";
}

function toggleLed(led){
  db.ref("led"+led).set(toggle${led}.checked?1:0);
}
</script>

</body>
</html>

